# 코너킥스 기능 명세서

## 1. 페이지 구조

```
/ (대시보드)
├── /sessions (일정 관리) ⭐ 핵심
│   └── /sessions/[id] (세션 상세)
│       ├── 개요/참석 탭
│       ├── 팀 구성 탭
│       ├── 점수판 탭 ⭐ 실시간 경기 기록
│       └── 선수 스탯 탭
├── /players (선수 명단)
│   └── /players/[id] (선수 상세)
├── /ranking (랭킹)
├── /hall-of-fame (명예의 전당)
├── /me (마이페이지)
├── /login (로그인)
└── /register (회원가입)
```

---

## 2. 상세 기능 명세

### 2.1 대시보드 (/)

#### 2.1.1 히어로 섹션
- 코너킥스 FC 브랜딩
- "수요일의 열정을 기록하고 공유하세요" 슬로건
- CTA 버튼: "일정 확인하기", "내 기록 보기"

#### 2.1.2 내 최근 기록 카드 (로그인 시)
- 최근 세션 날짜
- 득점, 도움, 수비, MVP점수
- 공격포인트 (골+어시스트), 출전 경기 수

#### 2.1.3 다음 일정
- 상태 배지 (모집중/마감)
- 날짜, 제목, 장소
- "결과 보기" 또는 "참가 신청" 버튼

#### 2.1.4 빠른 메뉴
| 메뉴 | 설명 | 링크 |
|------|------|------|
| 경기 결과 | 지난 매치 기록 확인 | /sessions |
| 랭킹 | 시즌 순위 확인 | /ranking |
| 능력치 평가 | 팀원 능력치 평가 | /players (평가 모드) |
| 명예의 전당 | 시즌 챔피언 보기 | /hall-of-fame |

#### 2.1.5 지난 세션 하이라이트
- 세션 날짜, 경기 수
- MVP (이름 + 점수)
- 득점왕 (이름 + 골 수)
- 도움왕 (이름 + 도움 수)
- 수비왕 (이름 + 수비 수)

---

### 2.2 일정 관리 (/sessions) ⭐

#### 2.2.1 일정 목록
- 세션 카드 리스트
- 상태 필터 (전체/모집중/마감/완료)
- 관리자: "새 일정 만들기" 버튼

#### 2.2.2 일정 생성 (관리자 전용)
**카카오톡 투표 파싱**
```
입력 예시:
2/11(수)
민호 준모 호규 호재 상훈 주현 용호 성호 훈락 상엽 재진 세준 12명

파싱 결과:
- 날짜: 2026-02-11
- 참석자: [민호, 준모, 호규, 호재, 상훈, 주현, 용호, 성호, 훈락, 상엽, 재진, 세준]
- 인원: 12명
- 장소: 수성대 풋살장 2번구장 (고정)
```

**파싱 규칙**
- 두 글자 이름 → 정회원 (players 테이블에서 검색)
- 두 글자 초과 → 용병으로 처리
  - "세준용병" → 세준용병
  - 동일 이름 다수 → xx용병1, xx용병2
- "대기", "불참" 등 키워드 제외

**미리보기**
- 파싱된 참석자 목록 표시
- 정회원 vs 용병 구분 표시
- 미등록 선수 경고 (새로 등록할지 확인)

#### 2.2.3 세션 상세 (/sessions/[id])

**탭 구조**
| 탭 | 설명 | 권한 |
|----|------|------|
| 개요/참석 | 세션 정보 + 참석자 명단 | 전체 |
| 팀 구성 | AI 팀 편성 결과 | 전체 (편성은 관리자) |
| 점수판 | 실시간 경기 기록 | 전체 |
| 선수 스탯 | 경기 후 개인 스탯 | 전체 |

---

### 2.3 팀 구성 시스템

#### 2.3.1 팀 수 결정
| 인원 | 팀 수 | 경기 수 | 팀당 경기 |
|------|-------|---------|-----------|
| 10~12명 | 2팀 | 1경기씩 반복 | - |
| 15~18명 | 3팀 | 9경기 | 6경기 |

#### 2.3.2 3팀 경기 로테이션
```
1라운드: A vs B (C 휴식)
2라운드: C vs A (B 휴식)
3라운드: B vs C (A 휴식)
... (3회 반복 = 총 9경기)
```

#### 2.3.3 AI 팀 편성 알고리즘
**입력 요소**
1. 선수 능력치 (10개 스탯의 합 또는 가중 평균)
2. 선호 팀원 (player_preferences)
3. 용병은 능력치 총합 90 기준

**출력**
- 팀 구성 (팀별 선수 리스트)
- 팀 유형 (밸런스형, 공격형, 수비형 등)
- 키플레이어 + 선정 이유
- 전략 설명
- 팀 예상 점수 (score_stats)

**편성 원칙**
1. 팀 간 총 능력치 균형
2. 포지션 밸런스 (공격/수비/올라운더)
3. 선호 팀원 최대한 반영
4. 케미스트리 고려 (향후)

---

### 2.4 점수판 (실시간 경기 기록) ⭐⭐⭐

#### 2.4.1 점수판 메인 화면
**리그 테이블**
| 순위 | 팀 | 경기 | 승 | 무 | 패 | 득 | 실 | 득실 | 승점 |
|------|-----|------|---|---|---|---|---|------|------|
| 1 | A팀 | 4 | 3 | 1 | 0 | 8 | 3 | +5 | 10 |
| 2 | B팀 | 4 | 2 | 0 | 2 | 5 | 5 | 0 | 6 |
| 3 | C팀 | 4 | 0 | 1 | 3 | 2 | 7 | -5 | 1 |

**경기 목록**
- 경기 번호, 대진 (A vs B)
- 스코어
- 상태 (예정/진행중/완료)
- 클릭 → 경기 상세

#### 2.4.2 경기 상세 (실시간 기록)
**타이머**
- 경기 진입 시 자동 시작 (10분 카운트업)
- 페이지 이탈해도 서버/로컬에서 계속 진행
- 일시정지/재개 가능

**스코어보드**
```
┌─────────────────────────────────────┐
│     A팀  2 : 1  B팀                 │
│           07:32                      │
└─────────────────────────────────────┘
```

**이벤트 기록 버튼**
- ⚽ 골 버튼 → 득점자 선택 → (선택) 어시스트 선택
- 🛡️ 호수비 버튼 → 수비자 선택

**이벤트 로그**
```
07:32 ⚽ 상훈 (어시스트: 민호)
05:15 🛡️ 용호 호수비
03:22 ⚽ 재진
```

**버튼**
- 저장하고 나가기 (임시 저장, 경기 계속)
- 경기 완료 (최종 저장, 상태 변경)
- 이벤트 취소 (최근 이벤트 삭제)

#### 2.4.3 데이터 저장 (CRUD)
**Create**
- match_events: 골/수비 이벤트
- player_match_stats: 경기별 선수 스탯 (자동 집계)

**Update**
- matches: 스코어, 상태
- teams: 순위, 승점 (경기 완료 시)

**Delete**
- 이벤트 취소 시 match_events에서 삭제
- 연관 스탯 재계산

**정합성 규칙**
1. 모든 통계는 match_events에서 파생
2. player_match_stats는 match_events의 집계
3. rankings_cache는 player_match_stats의 집계
4. 이벤트 수정 시 연쇄 업데이트

---

### 2.5 선수 명단 (/players)

#### 2.5.1 뷰 모드
- 카드뷰 (기본): 사진, 이름, 포지션, 주요 스탯
- 리스트뷰: 테이블 형식, 정렬/필터 가능

#### 2.5.2 관리자 패널 (상단)
- 비밀번호 초기화 (선수 선택 → 초기화)

#### 2.5.3 선수 카드
- 프로필 사진
- 이름 / 닉네임
- 능력치 레이더 차트
- 주요 기록 (골, 도움, 출석 등)

#### 2.5.4 선수 상세 (/players/[id])
- 상세 프로필
- 전체 능력치 (10개 항목)
- 시즌별 기록
- 획득 배지
- 최근 경기 기록

#### 2.5.5 선수 등록
- 세션 참석자 중 미등록 이름 → 자동 등록 제안
- 용병은 선수 명단에 등록 안 함

---

### 2.6 능력치 평가 시스템

#### 2.6.1 평가 권한
- 로그인한 모든 유저 가능

#### 2.6.2 평가 항목 (10개)
| 항목 | 설명 |
|------|------|
| shooting | 슈팅 |
| offball_run | 침투 (오프더볼) |
| ball_keeping | 볼키핑 |
| passing | 패스 |
| linkup | 연계 |
| intercept | 차단 |
| marking | 마킹 |
| stamina | 체력 |
| speed | 스피드 |
| physical | 피지컬 |

#### 2.6.3 가중 평균 계산
```
최종 능력치 = (관리자 평가 × 0.3) + (구단주 평가 × 0.3) + (일반 평가 평균 × 0.4)
```
- 관리자: role = 'ADMIN'
- 구단주: 별도 역할 필요 (또는 특정 user_id 지정)
- 일반: 나머지 평가자

#### 2.6.4 평가 UI
- 선수 선택
- 슬라이더 or 숫자 입력 (1~10)
- 코멘트 (선택)
- 제출

---

### 2.7 랭킹 (/ranking)

#### 2.7.1 시즌 선택
- 드롭다운으로 연도 선택 (2025, 2026...)

#### 2.7.2 랭킹 테이블
| 순위 | 이름 | 경기 | 골 | 도움 | 승점 | PPM | 승률 | 출석 | 수비 | MVP |
|------|------|------|-----|------|------|-----|------|------|------|-----|
| 1 | 상훈 | 18 | 6 | 3 | 9 | 0.5 | 11.1% | 3 | 12 | 0 |

**지표 설명**
- PPM: Points Per Match (승점/경기)
- 승률: (승리 경기 / 전체 경기) × 100
- 수비: 호수비 횟수

#### 2.7.3 관리자 기능
- "랭킹 새로고침" 버튼 → rankings_cache 갱신

#### 2.7.4 캐시 전략
- rankings_cache 테이블에 JSON으로 저장
- 관리자가 수동 갱신 (성능 이슈 방지)

---

### 2.8 명예의 전당 (/hall-of-fame)

#### 2.8.1 등극 조건
1. 해당 시즌 25세션 이상 참석
2. 특정 지표에서 1등

#### 2.8.2 영예 카테고리
| 영예 | 기준 |
|------|------|
| 득점왕 | 최다 골 |
| 도움왕 | 최다 어시스트 |
| 공격포인트왕 | 골+어시스트 |
| 수비왕 | 최다 호수비 |
| MVP | 최다 MVP 선정 |
| 출석왕 | 최다 출석 |
| 승률왕 | 최고 승률 |

#### 2.8.3 UI
- 시즌별 섹션
- 트로피 아이콘 + 선수 카드
- 기록 수치 표시

---

### 2.9 마이페이지 (/me)

#### 2.9.1 프로필 섹션
- 프로필 사진
- 이름 / 닉네임 / 별칭
- 연락처, 생년월일, 키, 몸무게

#### 2.9.2 내 기록
- 통산 기록 (골, 도움, 경기, 승률 등)
- 시즌별 기록

#### 2.9.3 내 능력치
- 레이더 차트
- 10개 항목 수치

#### 2.9.4 선호 팀원 설정
- 1~3순위 선호 팀원 선택
- 팀 편성 시 반영

#### 2.9.5 배지 컬렉션
- 획득한 배지 표시
- 미획득 배지는 흐리게

#### 2.9.6 계정 설정
- 비밀번호 변경
- 프로필 수정

---

### 2.10 인증 (/login, /register)

#### 2.10.1 로그인
- 이메일 + 비밀번호
- 자동 로그인 (Remember me)

#### 2.10.2 회원가입
- 이메일, 비밀번호, 이름
- 선수 연동 (player_code 입력)

#### 2.10.3 선수 연동 플로우
1. 관리자가 선수 등록 (link_status = UNLINKED)
2. 선수에게 player_code 전달
3. 유저가 회원가입 시 코드 입력
4. link_status = PENDING
5. 관리자 승인 → ACTIVE

---

## 3. 권한 매트릭스

| 기능 | 비로그인 | 일반유저 | 관리자 |
|------|----------|----------|--------|
| 대시보드 조회 | ✅ | ✅ | ✅ |
| 세션 조회 | ✅ | ✅ | ✅ |
| 세션 생성/삭제 | ❌ | ❌ | ✅ |
| 팀 편성 | ❌ | ❌ | ✅ |
| 경기 기록 | ❌ | ✅ | ✅ |
| 선수 조회 | ✅ | ✅ | ✅ |
| 능력치 평가 | ❌ | ✅ | ✅ |
| 비밀번호 초기화 | ❌ | ❌ | ✅ |
| 랭킹 새로고침 | ❌ | ❌ | ✅ |
| 마이페이지 | ❌ | ✅ (본인) | ✅ |

---

## 4. 데이터 정합성 규칙

### 4.1 Source of Truth
```
match_events (골/수비 이벤트)
    ↓ 집계
player_match_stats (경기별 스탯)
    ↓ 집계
rankings_cache (시즌 랭킹)
```

### 4.2 이벤트 수정 시 연쇄 업데이트
1. match_events 수정/삭제
2. → player_match_stats 재계산
3. → matches 스코어 재계산
4. → teams 승점/순위 재계산
5. → (수동) rankings_cache 갱신

### 4.3 용병 처리
- 세션 내에서만 존재 (team_members에만 등록)
- players 테이블에 등록 안 함
- match_events에는 임시 ID 또는 이름으로 기록?
  → 검토 필요: 용병도 players에 is_guest=1로 등록하는 게 나을 수 있음

---

## 5. 배지 시스템

### 5.1 현재 배지 (9개)
| 코드 | 이름 | 조건 |
|------|------|------|
| first_goal | 데뷔골 | 첫 골 |
| goal_5 | 스트라이커 | 5골 |
| goal_10 | 득점 기계 | 10골 |
| assist_5 | 특급 도우미 | 5도움 |
| assist_10 | 마에스트로 | 10도움 |
| rank_1 | 첫 우승 | 첫 1등 |
| rank_top3 | 포디움 | 3등 이내 |
| attendance_5 | 성실맨 | 5회 출석 |
| attendance_10 | 개근상 | 10회 출석 |

### 5.2 추가 배지 제안 (향후)
- 해트트릭: 한 경기 3골
- 풀타임: 한 세션 전 경기 출전
- 클린시트: 무실점 경기 수비 기여
- 연승: 3연승
- 등등...

---

## 6. 기술 요구사항

### 6.1 실시간 기능
- 경기 타이머 (페이지 이탈해도 유지)
- 이벤트 기록 즉시 반영

### 6.2 오프라인/재접속
- 타이머 상태 복원
- 미저장 이벤트 복구

### 6.3 성능
- 랭킹 캐시로 로딩 속도 개선
- 이미지 최적화

### 6.4 반응형
- 모바일 우선 (경기장에서 사용)
- 터치 친화적 UI
